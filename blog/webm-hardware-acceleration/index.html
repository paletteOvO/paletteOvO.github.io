<!DOCTYPE html><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v3.5.2"><!-- Canonical URL --><link rel="canonical" href="https://paletteovo.moe/blog/webm-hardware-acceleration/"><!-- Primary Meta Tags --><title>WebM的超高CPU佔用問題 (Firefox/Chrome/WallpaperEngine)</title><meta name="title" content="WebM的超高CPU佔用問題 (Firefox/Chrome/WallpaperEngine)"><meta name="description" content=""><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://paletteovo.moe/blog/webm-hardware-acceleration/"><meta property="og:title" content="WebM的超高CPU佔用問題 (Firefox/Chrome/WallpaperEngine)"><meta property="og:description" content=""><meta property="og:image" content="https://paletteovo.moe/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://paletteovo.moe/blog/webm-hardware-acceleration/"><meta property="twitter:title" content="WebM的超高CPU佔用問題 (Firefox/Chrome/WallpaperEngine)"><meta property="twitter:description" content=""><meta property="twitter:image" content="https://paletteovo.moe/blog-placeholder-1.jpg"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><link rel="stylesheet" href="/_astro/_name_.697908ee.css" />
<style>.article[data-astro-cid-hvlazojn]{overflow-wrap:break-word;*{margin:14px 0}br {margin: 0;} h1,h2,h3,h4,h5,h6 {position: relative; margin: 24px 0; font-weight: 700; font-size: 1.25rem;} p {margin: 0 0 16px; line-height: 1.8; font-size: .875rem; opacity: .875;} li::marker {content: "- "; font-weight: 900;} li {margin-left: 1.2rem;} code {font-family: monospace;}}
</style><script type="module" src="/_astro/hoisted.124216b5.js"></script><body class="flex flex-col" data-astro-cid-hvlazojn><div class="bg-gradient w-100vw h-100vh fixed top-0 right-0 bottom-0 left-0 z--10000"></div><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var b=Object.defineProperty;var f=(c,o,i)=>o in c?b(c,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[o]=i;var l=(c,o,i)=>(f(c,typeof o!="symbol"?o+"":o,i),i);var p;{let c={0:t=>m(t),1:t=>i(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(i(t)),5:t=>new Set(i(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[e,r]=t;return e in c?c[e](r):void 0},i=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,r])=>[e,o(r)]));customElements.get("astro-island")||customElements.define("astro-island",(p=class extends HTMLElement{constructor(){super(...arguments);l(this,"Component");l(this,"hydrator");l(this,"hydrate",async()=>{var d;if(!this.hydrator||!this.isConnected)return;let e=(d=this.parentElement)==null?void 0:d.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let r=this.querySelectorAll("astro-slot"),a={},h=this.querySelectorAll("template[data-astro-template]");for(let n of h){let s=n.closest(this.tagName);s!=null&&s.isSameNode(this)&&(a[n.getAttribute("data-astro-template")||"default"]=n.innerHTML,n.remove())}for(let n of r){let s=n.closest(this.tagName);s!=null&&s.isSameNode(this)&&(a[n.getAttribute("name")||"default"]=n.innerHTML)}let u;try{u=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(n){let s=this.getAttribute("component-url")||"<unknown>",y=this.getAttribute("component-export");throw y&&(s+=` (export ${y})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),n),n}await this.hydrator(this)(this.Component,u,a,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});l(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),r.disconnect(),this.childrenConnectedCallback()},r=new MutationObserver(()=>{var a;((a=this.lastChild)==null?void 0:a.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});r.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}start(){let e=JSON.parse(this.getAttribute("opts")),r=this.getAttribute("client");if(Astro[r]===void 0){window.addEventListener(`astro:${r}`,()=>this.start(),{once:!0});return}Astro[r](async()=>{let a=this.getAttribute("renderer-url"),[h,{default:u}]=await Promise.all([import(this.getAttribute("component-url")),a?import(a):()=>()=>{}]),d=this.getAttribute("component-export")||"default";if(!d.includes("."))this.Component=h[d];else{this.Component=h;for(let n of d.split("."))this.Component=this.Component[n]}return this.hydrator=u,this.hydrate},e,this)}attributeChangedCallback(){this.hydrate()}},l(p,"observedAttributes",["props"]),p))}})();</script><astro-island uid="Z1OiHHE" component-url="/_astro/Header.dc49c97b.js" component-export="default" renderer-url="/_astro/client.5a780954.js" props="{&quot;data-astro-cid-hvlazojn&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Header&quot;,&quot;value&quot;:&quot;solid-js&quot;}"></astro-island><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><astro-island uid="26Csdl" data-solid-render-id="s0" component-url="/_astro/TopBackground.b43470ba.js" component-export="default" renderer-url="/_astro/client.5a780954.js" props="{&quot;class&quot;:[0,&quot;h-360px sm:h-540px lt-sm:justify-end lt-sm:p-8 sm:items-center sm:justify-center&quot;],&quot;data-astro-cid-hvlazojn&quot;:[0,true]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;TopBackground&quot;,&quot;value&quot;:true}" await-children=""><div data-hk="s00-0" id="top" class="h-360px sm:h-540px lt-sm:justify-end lt-sm:p-8 sm:items-center sm:justify-center top animate-fade-in animate-duration-500 w-full relative flex flex-col elevation-1"><!--$--><astro-slot><h1 data-hk="0-0" class="text-white text-3xl drop-shadow-md flex text-center">WebM的超高CPU佔用問題 (Firefox/Chrome/WallpaperEngine)</h1><div data-hk="0-1" class="mt-4 text-white drop-shadow-md flex opacity-80"><span class="flex items-center text-0.875rem"><div class="text-base mr-1 i-material-symbols:calendar-month-outline-rounded"></div><span class="mr-1 lt-sm:hidden">Created on</span><time datetime="2021-11-05T00:00:00.000Z">Nov 5, 2021</time></span><!--$--><!--/--></div></astro-slot><!--/--><div class="cursor-pointer absolute bottom-0 left-0 right-0 flex items-center justify-center pt-4 pb-2 drop-shadow-md"></div></div><!--astro:end--></astro-island><main class="bg-white flex-grow" data-astro-cid-hvlazojn><div class="h-16" data-astro-cid-hvlazojn></div><!-- <BlogPost client:only="solid-js" post={post} /> --><div class="w-full flex flex-col items-center px-4" data-astro-cid-hvlazojn><article class="article line-numbers animate-fade-in duration-1000 w-full max-w-960px elevation-1 bg-gradient-1 p-8 rounded-3" data-astro-cid-hvlazojn><div data-astro-cid-hvlazojn><h2>TL;DR</h2>
<p>如果你只是來找解決方案的話：</p>
<ol>
<li>請確定你更新到了最新的 Windows Update</li>
<li>請確定你的顯卡驅動已經是最新的了</li>
<li>請確定你的顯卡支持 WebM(VP9) 硬解</li>
<li>根據此教程安裝 LAV (右上角可選擇語言) <a href="https://help.wallpaperengine.io/en/videos/lav.html#_1-install-lav">Using LAV and DirectShow | Wallpaper Engine - Troubleshooting &amp; FAQ</a></li>
<li>安裝微軟的 VP9 解碼擴展 <a href="https://www.microsoft.com/en-us/p/vp9-video-extensions/9n4d0msmp0pt?activetab=pivot:overviewtab">Get VP9 Video Extensions - Microsoft Store</a></li>
<li>摸摸你家可愛的小貓</li>
<li>現在你應該可以看到你的 GPU 終於不是 0% 佔用了<br><img loading="lazy" decoding="async" data-blurhash="UbS60qt:OFMv.AnfozoNxwjXofoM%LkDRjRj" width="774" height="50" data-src="/_posts/webm-hardware-acceleration/Snipaste_2021-11-04_03-24-01.png?blurhash=UbS60qt%3AOFMv.AnfozoNxwjXofoM%25LkDRjRj&width=774&height=50"  data-alt="Before" /><br><img loading="lazy" decoding="async" data-blurhash="UmR{oRtoRjNE.Anfofogt9jXf7j]%LkDWBR%" width="784" height="46" data-src="/_posts/webm-hardware-acceleration/Snipaste_2021-11-04_03-25-42.png?blurhash=UmR%7BoRtoRjNE.Anfofogt9jXf7j%5D%25LkDWBR%25&width=784&height=46"  data-alt="After" /><br>如果你不成功，可以留言和我說說，我可能也可能不會看。</li>
</ol>
<h2>0x0 前言</h2>
<p>整件事基本上是從 Wallpaper Engine 引起的，前兩天試圖補了幀然後給桌面換一個高幀的視頻桌布，而且還想加特效，於是就選了一個好看的改了起來。</p>
<h2>0x1 Wallpaper Engine 的 Web 不支持 MP4</h2>
<p>不過這也不是甚麼大問題，換個格式就好了<del>，雖然折騰 ffmpeg 的無損轉換也花了好久</del>。</p>
<pre class="shiki github-light" style="background-color: #fff" tabindex="0"><code><span class="line"><span style="color: #24292e">ffmpeg -i input.mp4 -c:v libvpx-vp9 -threads 8 -lossless 1 -filter:v fps=60 output.webm</span></span></code></pre><h2>0x2 超高的 CPU 佔用</h2>
<p>非常高，基本上把 CPU 給佔滿了，這種情況顯然是不可能正常用電腦的，但視頻一般都是 GPU 解碼，不應該是 CPU，所以很明顯視頻硬件加速出了問題。但是 VLC 是可以正常播放的。</p>
<p>但是，我翻遍了谷歌，翻遍了 steam 論壇，都沒找到任何線索，不得不說這是有點離譜的，我估計是因為根本沒人用 webm，大多數純視頻壁紙都是 mp4。而且 Wallpaper Engine 並不直接支持 WebM 的視頻壁紙，所以只有少數支持了自定義視頻的網頁背景會遇到這個問題。</p>
<p>於是，我去翻了翻 Wallpaper Engine 的 F&amp;Q，找到了(Using LAV and DirectShow | Wallpaper Engine - Troubleshooting &amp; FAQ)[<a href="https://help.wallpaperengine.io/en/videos/lav.html#_1-install-lav%5D%EF%BC%8C%E6%88%90%E5%8A%9F%E8%A7%A3%E6%B1%BA%E4%BA%86%E7%9B%B4%E6%8E%A5%E6%92%AD%E6%94%BE">https://help.wallpaperengine.io/en/videos/lav.html#_1-install-lav]，成功解決了直接播放</a> WebM 的加速問題。</p>
<p>雖然但是，為了加上 kirakira 的特效，我要在 Web 裡播放，但在Ｗ eb 裡播放時的佔用還是很高啊。於是考慮到他是 Web 播放，我先後用 Firefox 和 Edge 試着播放，發現他們的佔用也很高，所以基本上可以確定是瀏覽器和硬解的問題。</p>
<p>然而在 edge://gpu 裡可以明顯看到， vp9 硬件加速是打開了的，所以是甚麼原因呢？</p>
<p>於是在一輪輪的搜索下(花了好幾個小時查資料試錯，這裡就不累贅了，雖然一堆人吐槽 WebM 慢，但沒人給出解決方法)，我從一個 reddit 的評論裡找到了這個<a href="https://www.microsoft.com/en-us/p/vp9-video-extensions/9n4d0msmp0pt">Get VP9 Video Extensions - Microsoft Store</a> (抱歉我已經找不回那個帖子了，畢竟我是過了好一會才想起來寫一篇文章說說這個)</p>
<p>裝上後可以很明顯看到 GPU 的佔用終於上升了，但我認為可能並不是真的解決了，按照 VP9 Video Extensions 的描述是給沒有硬體加速的人用的，所以看似解決了，但其實並不是直接交給 GPU 解碼 VP9，不過至少他終於不把 CPU 給佔滿了。</p>
<h2>0x3 後記</h2>
<p>待我有空的時候可能會再研究研究為甚麼不能加速，3060 總不至於連 VP9 編碼都不支持吧，話說我也沒找到支持列表，這裡還是建議 NVIDIA 爬一爬，我甚至覺得可能是 Win11 的問題，但我暫時也沒時間去重裝甚至降級，所以就只能先放着了。</p>
</div></article></div><div class="h-16" data-astro-cid-hvlazojn></div></main><astro-island uid="Ke50T" component-url="/_astro/Footer.e1c0b1e8.js" component-export="default" renderer-url="/_astro/client.5a780954.js" props="{&quot;class&quot;:[0,&quot;flex&quot;],&quot;data-astro-cid-hvlazojn&quot;:[0,true]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Footer&quot;,&quot;value&quot;:&quot;solid-js&quot;}"></astro-island></body>